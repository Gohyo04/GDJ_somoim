<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <!-- mapper namespace는 비우면 에러 -->
  <mapper namespace="com.somoim.app.chat.ChatMessageDAO">
  	
  	<!-- ChatRoom -->
  	<insert id="addChatRoom">
  		INSERT INTO CHATROOM (CHATROOMNUM) VALUES (CHATROOM_SEQ.NEXTVAL)
  	</insert>
  	  	
  	<select id="chatRoomCh" resultType="Long">
  		SELECT DISTINCT CHATROOMNUM FROM CHATROOM
  	</select>
  	
  	<select id="chatRoomList" parameterType="MemberDTO" resultType="Long">
  		SELECT DISTINCT CHATROOMNUM
			FROM CHATMESSAGE
		WHERE USERNAME = #{userName}
  	</select>
  	
  	<!-- Chat -->
  	<!-- parameter member(userName), chatRoom(chatRoomNum) -->
  	<insert id="addChat" parameterType="ChatMessageDTO">
  		INSERT INTO CHATMESSAGE 
			(MESSAGENUM, CHATROOMNUM, USERNAME, CHATTEXT, CHATTIMESTAMP)
		VALUES
			(MESSAGE_SEQ.NEXTVAL, 1, #{userName}, #{chatText}, SYSDATE)
  	</insert>

	<select id="chatHistory" parameterType="ChatMessageDTO" resultType="ChatMessageDTO">
		SELECT * 
			FROM CHATMESSAGE
		WHERE CHATROOMNUM = #{chatRoomNum}
	</select>
  </mapper>